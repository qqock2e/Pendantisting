let points = 0;
        let prisms = 0;
        let gems = 0; // ë³´ì„ ë³„ë„ ê´€ë¦¬
        let chorus = 0;
        let multiple = 1;
        let isGachaActive = false; // ë½‘ê¸° ì§„í–‰ ì¤‘ ìƒíƒœ ê´€ë¦¬
        let inventory = {}; // ì¸ë²¤í† ë¦¬ ê°ì²´ (ë³´ì„ID: ê°œìˆ˜)
        let equippedGems = []; // ì¥ì°©ëœ ë³´ì„ ID ë°°ì—´ (ë‹¤ì¤‘ ì¥ì°©)
        let currentGachaResults = []; // 10íšŒ ë½‘ê¸° ê²°ê³¼ ì €ì¥
        
        // ë³¼ë¥¨ ì‹œìŠ¤í…œ
        let volumes = {
            multi: false,    // ë©€í‹° ë³¼ë¥¨ ë³´ìœ  ì—¬ë¶€
            chorus: false,   // ì½”ëŸ¬ìŠ¤ ë³¼ë¥¨ ë³´ìœ  ì—¬ë¶€
            lux: false       // ëŸ­ìŠ¤ ë³¼ë¥¨ ë³´ìœ  ì—¬ë¶€
        };
        let maxSlots = 1; // ìµœëŒ€ ì¥ì°© ìŠ¬ë¡¯ ìˆ˜

        const pointsDisplay = document.getElementById('points');
        const prismsDisplay = document.getElementById('prisms');
        const earnPointsBtn = document.getElementById('earnPointsBtn');
        const shopBtn = document.getElementById('shopBtn');
        const inventoryBtn = document.getElementById('inventoryBtn');
        const messageDiv = document.getElementById('message');


        // ë³´ì„ ë°ì´í„° (ìœ ì§€ë³´ìˆ˜ ì‰½ê²Œ í•˜ê¸° ìœ„í•´ ë³„ë„ ê°ì²´ë¡œ ê´€ë¦¬)
        const gemData = {
            1: { name: 'ì‘ì€ ìˆ˜ì •', emoji: 'ğŸ’', chorus: 1, multiple: 1, description: 'ì‘ê³  íˆ¬ëª…í•œ ìˆ˜ì •ì…ë‹ˆë‹¤.' },
            2: { name: 'í‘¸ë¥¸ ìˆ˜ì •', emoji: 'ğŸ”·', chorus: 2, multiple: 1, description: 'í‘¸ë¥¸ë¹›ì´ ë„ëŠ” ì•„ë¦„ë‹¤ìš´ ìˆ˜ì •ì…ë‹ˆë‹¤.' },
            3: { name: 'ë¶‰ì€ ìˆ˜ì •', emoji: 'ğŸ”¶', chorus: 3, multiple: 1, description: 'ë¶‰ì€ë¹›ì´ ë„ëŠ” í™”ë ¤í•œ ìˆ˜ì •ì…ë‹ˆë‹¤.' },
            4: { name: 'ì—ë©”ë„ë“œ', emoji: 'ğŸ’š', chorus: 4, multiple: 1, description: 'ì‹ ë¹„ë¡œìš´ ë…¹ìƒ‰ ë³´ì„ì…ë‹ˆë‹¤.' },
            5: { name: 'ì‚¬íŒŒì´ì–´', emoji: 'ğŸ’™', chorus: 5, multiple: 1, description: 'ê¹Šì€ íŒŒë€ìƒ‰ì˜ ê³ ê¸‰ ë³´ì„ì…ë‹ˆë‹¤.' },
            6: { name: 'ë£¨ë¹„', emoji: 'â¤ï¸', chorus: 6, multiple: 1, description: 'ì •ì—´ì ì¸ ë¹¨ê°„ìƒ‰ ë³´ì„ì…ë‹ˆë‹¤.' },
            7: { name: 'ììˆ˜ì •', emoji: 'ğŸ’œ', chorus: 7, multiple: 1.1, description: 'ê³ ê·€í•œ ë³´ë¼ìƒ‰ ë³´ì„ì…ë‹ˆë‹¤.' },
            8: { name: 'í™©ê¸ˆì„', emoji: 'ğŸ’›', chorus: 8, multiple: 1.2, description: 'í™©ê¸ˆë¹›ìœ¼ë¡œ ë¹›ë‚˜ëŠ” ë³´ì„ì…ë‹ˆë‹¤.' },
            9: { name: 'ë‹¤ì´ì•„ëª¬ë“œ', emoji: 'ğŸ’', chorus: 9, multiple: 1.3, description: 'ê°€ì¥ ë‹¨ë‹¨í•˜ê³  ë¹›ë‚˜ëŠ” ë³´ì„ì…ë‹ˆë‹¤.' },
            10: { name: 'ì˜¤íŒ”', emoji: 'ğŸŒˆ', chorus: 10, multiple: 1.4, lux: 0.5, description: 'ë¬´ì§€ê°œë¹›ìœ¼ë¡œ ë³€í•˜ëŠ” ì‹ ë¹„í•œ ë³´ì„ì…ë‹ˆë‹¤.' },
            11: { name: 'ì§„ì£¼', emoji: 'ğŸ¤', chorus: 11, multiple: 1.5, lux: 0.8, description: 'ë°”ë‹¤ì—ì„œ ì˜¨ ìˆœë°±ì˜ ë³´ì„ì…ë‹ˆë‹¤.' },
            12: { name: 'í† íŒŒì¦ˆ', emoji: 'ğŸ§¡', chorus: 12, multiple: 1.6, lux: 1.0, description: 'ë”°ëœ»í•œ ì£¼í™©ë¹›ì˜ ë³´ì„ì…ë‹ˆë‹¤.' },
            13: { name: 'ë³„ì˜ ì¡°ê°', emoji: 'â­', chorus: 15, multiple: 2.0, lux: 2.5, description: 'í•˜ëŠ˜ì—ì„œ ë–¨ì–´ì§„ ë³„ì˜ ì¡°ê°ì…ë‹ˆë‹¤.' },
            14: { name: 'ë‹¬ì˜ ëˆˆë¬¼', emoji: 'ğŸŒ™', chorus: 20, multiple: 2.5, lux: 4.0, description: 'ë‹¬ë¹›ì´ ì‘ì¶•ëœ ì‹ ë¹„í•œ ë³´ì„ì…ë‹ˆë‹¤.' },
            15: { name: 'íƒœì–‘ì˜ ì‹¬ì¥', emoji: 'â˜€ï¸', chorus: 25, multiple: 3.0, lux: 5.0, description: 'íƒœì–‘ì˜ í˜ì´ ë‹´ê¸´ ì „ì„¤ì˜ ë³´ì„ì…ë‹ˆë‹¤.' },
            16: { name: 'ì¹´ë¥´ë§ˆ ë²¨', emoji: 'â˜¯', chorus: 34, multiple: 3.4, lux: 6.0, description: 'ìˆ˜ë°±ë…„ì „ ë–¨ì–´ì§„ í˜œì„±ì—ì„œ ë–¨ì–´ì§„ íŒŒí¸ì…ë‹ˆë‹¤. ì–´ì©ì§€ í„¸ì´..ë‚ ë¦¬ëŠ”ê²ƒ ê°™ë„¤ìš”?' },
            17: { name: 'íŒŒì‹œí‹°ì…˜íŠ¸', emoji: 'ğŸ”®', chorus: 36, multiple: 4.0, lux: 10.0, description: 'íƒœí‰ì–‘ ì–´ëŠ ì‹¬í•´ì—ì„œ ë°œê²¬ëœ ë¹›ì´ë‚˜ëŠ” ë³´ì„ì…ë‹ˆë‹¤.' },
            18: { name: 'í´ë¦¬ ì•„ì´ë“œ', emoji: 'ğŸ§¿', chorus: 30, multiple: 4.1, lux: 8.3, description: 'í‘¸ë¥¸ë¹›ì˜ ëˆˆì²˜ëŸ¼ ìƒê¸´ ë³´ì„ì…ë‹ˆë‹¤.' },
            19: { name: 'íŒ”ë¼í‹± ì¡°ì»¤', emoji: 'ğŸƒ', chorus: 17, multiple: 7.7, lux: 7.7, description: '<ë‹¤ì´ìŠ¤ ë£¸> ì¹´ì§€ë…¸ì—ì„œ ë§Œë“  ì¸ì¡° ë³´ì„ì…ë‹ˆë‹¤. VIPì—ê²Œ í–‰ìš´ì„ ê¸°ì›í•˜ëŠ” ì˜ë¯¸ë¡œ ì£¼ì–´ì§‘ë‹ˆë‹¤.' },
            20: { name: 'ë‹¤ì´ìŠ¤í†¤', emoji: 'ğŸ²', chorus: 6, multiple: 1.6, description: '<ë‹¤ì´ìŠ¤ ë£¸> ì™¸ë²½ì„ ì´ë£¨ëŠ” ëŒ€ë¦¬ì„ê³¼ ë¹„ìŠ·í•œ ì¬ì§ˆì˜ ê´‘ì„ì…ë‹ˆë‹¤.' },
            21: { name: 'í—¬ í¬ë¦¼ìŠ¨', emoji: 'ğŸ“›', chorus: 44, multiple: 4.4, lux: 4.4, description: 'ì§€ì˜¥ì˜ ì¡°ê°œê°€ ë±‰ì€ ì§„ì£¼ì…ë‹ˆë‹¤. ë‚´ë¶€ì— ìš©ì•”ì´ íë¦…ë‹ˆë‹¤.'},
            22: { name: 'í™€ë¦¬í‹± ë¼í”¼ìŠ¤', emoji: 'ğŸª½', chorus: 77 , multiple: 7.7 , lux: 7.7 , description: 'ì²œêµ­ì—ì„œ ì“°ëŠ” í—¤ë¸ ë¸”ë£¨ ì—¼ë£Œë¥¼ ì œì‘í• ë•Œ ì“°ëŠ” ê°’ë¹„ì‹¼ ë³´ì„ì…ë‹ˆë‹¤.'},
            23: { name: 'ì°¨ìŠ¤í‹°ì›€', emoji: 'ğŸ–±', chorus: 10 , multiple: 1.3 , description: 'ì•„ì£¼ ë§‘ê³  ìˆœë°±í•œ ìƒ‰ì˜ ìˆ˜ì •ì…ë‹ˆë‹¤. íŠ¹ë³„í•œ ê³³ì— ì‚¬ìš©í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ì•„ìš”.'},
            24: { name: 'ì •ì œëœ ì‘ì€ ìˆ˜ì •', emoji: 'ğŸ’ ', chorus: 52 , multiple: 6.3 , lux: 5.3 , description: 'ìˆœê²°í•œ í˜ìœ¼ë¡œ ì •ì œëœ ì‘ì€ ìˆ˜ì •ì…ë‹ˆë‹¤. ì§„ì •í•œ í˜ì´ ê°œë°©ë˜ì—ˆìŠµë‹ˆë‹¤.'},
            25: { name: 'ì •ì¬ëœ ì˜¤íŒ”', emoji: 'ğŸ¨', chorus: 69 , multiple: 6.7 , lux: 7.0 , description: 'ìˆœê²°í•œ í˜ìœ¼ë¡œ ì •ì œëœ ì˜¤íŒ”ì…ë‹ˆë‹¤. ì°¬ë€í•œ ë¬´ì§€ê°¯ë¹›ì´ íŠ¹ì§•ì…ë‹ˆë‹¤.'},
            26: { name: 'ì •ì œëœ í™©ê¸ˆì„', emoji: 'â­', chorus: 67 , multiple: 7.1 , lux: 6.8 , description: 'ìˆœê²°í•œ í˜ìœ¼ë¡œ ì •ì œëœ í™©ê¸ˆì„ì…ë‹ˆë‹¤. ë¶ˆìˆœë¬¼ ì—†ëŠ” ì§„ì§œ ìˆœ@ê¸ˆì´ì£ .'},
            27: { name: 'GM', emoji: 'â­', chorus: 99999 , multiple: 1.1 , lux: 100.0 , description: 'GM.'}
        };

        // ë³´ì„ ë“±ê¸‰ í™•ì¸ í•¨ìˆ˜
        function getGemGrade(gemId) {
            for (const [grade, gemIds] of Object.entries(gemRewards)) {
                if (gemIds.includes(parseInt(gemId))) {
                    return grade;
                }
            }
            return 'ì¼ë°˜'; // ê¸°ë³¸ê°’
        }

        // í™”ë©´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateDisplay() {
            pointsDisplay.textContent = points;
            prismsDisplay.textContent = prisms;
        }

        // ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
        function showMessage(text, color = 'text-white') {
            messageDiv.textContent = text;
            messageDiv.className = `mt-8 text-center font-medium text-lg transition-opacity duration-300 ${color}`;
            messageDiv.style.opacity = '1';
            
            setTimeout(() => {
                messageDiv.style.opacity = '0';
            }, 2000);
        }
        // ì‚¬ìš©í•œ ì½”ë“œ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
function loadUsedCodes() {
    const data = localStorage.getItem("usedRedeemCodes");
    return data ? JSON.parse(data) : [];
}

// ì½”ë“œ ì‚¬ìš© ê¸°ë¡ ì €ì¥
function saveUsedCodes(usedCodes) {
    localStorage.setItem("usedRedeemCodes", JSON.stringify(usedCodes));
}
        
        // ì½”ë“œ ë³´ìƒ ì‹œìŠ¤í…œ
    const redeemCodes = {
        "ReF5in3": { gem : [23] , used: false },
        //"pansa082810": { gems : [27] , used: false },
        //"ì“°ë©´ ë¸…": { gems : [1] , used: false},
        "09082810": { gems : [23] , used: false
        // ì—¬ê¸°ì— ë” ì¶”ê°€ ê°€ëŠ¥
    };

    document.getElementById('redeemCodeBtn').addEventListener('click', () => {
    const input = document.getElementById('codeInput').value.trim();
    const message = document.getElementById('codeMessage');

    if (!input) {
        message.textContent = "ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”!";
        message.className = "text-xs text-red-400 mt-1";
        return;
    }

    const reward = redeemCodes[input];
    const usedCodes = loadUsedCodes();

    if (reward && !usedCodes.includes(input)) {
        let rewardMsg = [];

        // í”„ë¦¬ì¦˜ ì§€ê¸‰
        if (reward.prisms) {
            prisms += reward.prisms;
            rewardMsg.push(`${reward.prisms} í”„ë¦¬ì¦˜`);
        }

        // ë³´ì„ ì§€ê¸‰
        if (reward.gem && Array.isArray(reward.gem)) {
            reward.gem.forEach(gemId => {
                if (inventory[gemId]) {
                    inventory[gemId]++;
                } else {
                    inventory[gemId] = 1;
                }
                rewardMsg.push(`${gemData[gemId].name} 1ê°œ`);
            });
          if (reward.gems && Array.isArray(reward.gems)) {
            reward.gems.forEach(gemId => {
                if (inventory[gemId]) {
                    inventory[gemId] += 990;
                } else {
                    inventory[gemId] = 1;
                }
                rewardMsg.push(`${gemData[gemId].name} 990ê°œ`);
            });
        }

        // ê°œë°œì ë„êµ¬ ë‹¨ì¶•í‚¤ ì°¨ë‹¨
document.addEventListener('keydown', function(e) {
    // F12
    if (e.keyCode === 123) {
        e.preventDefault();
        alert("ê°œë°œì ë„êµ¬ ì‚¬ìš©ì´ ì œí•œë˜ì—ˆìŠµë‹ˆë‹¤!");
        return false;
    }
    // Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U
    if (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74)) {
        e.preventDefault();
        alert("ê°œë°œì ë„êµ¬ ì‚¬ìš©ì´ ì œí•œë˜ì—ˆìŠµë‹ˆë‹¤!");
        return false;
    }
    if (e.ctrlKey && e.keyCode === 85) {
        e.preventDefault();
        alert("ì†ŒìŠ¤ ë³´ê¸°ê°€ ì œí•œë˜ì—ˆìŠµë‹ˆë‹¤!");
        return false;
    }
});

// ìš°í´ë¦­ ë°©ì§€
document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
    alert("ìš°í´ë¦­ì´ ì œí•œë˜ì—ˆìŠµë‹ˆë‹¤!");
});

        updateDisplay();
        updateInventoryDisplay();
        autoSave();

        // ì‚¬ìš© ê¸°ë¡ ì €ì¥
        usedCodes.push(input);
        saveUsedCodes(usedCodes);

        message.textContent = `${rewardMsg.join(", ")}ë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤!`;
        message.className = "text-xs text-green-400 mt-1";
    } else if (reward && usedCodes.includes(input)) {
        message.textContent = "ì´ë¯¸ ì‚¬ìš©í•œ ì½”ë“œì…ë‹ˆë‹¤!";
        message.className = "text-xs text-yellow-400 mt-1";
    } else {
        message.textContent = "ì˜ëª»ëœ ì½”ë“œì…ë‹ˆë‹¤!";
        message.className = "text-xs text-red-400 mt-1";
    }
});



        // í¬ì¸íŠ¸ íšë“ ë²„íŠ¼ í´ë¦­
        // ë§¤í¬ë¡œ ê°ì§€ ê´€ë ¨ ë³€ìˆ˜
let clickHistory = [];
let macroTimer = null;
let macroActive = false;

// ë§¤í¬ë¡œ ëª¨ë‹¬ ì—˜ë¦¬ë¨¼íŠ¸
const macroModal = document.getElementById("macroModal");

function openMacroModal() {
    if (macroActive) return; // ì´ë¯¸ ë– ìˆìœ¼ë©´ ì¤‘ë³µ ë°©ì§€
    macroActive = true;
    macroModal.classList.remove("hidden");
    resetMacroCloseTimer();
}

function closeMacroModal() {
    macroActive = false;
    macroModal.classList.add("hidden");
    if (macroTimer) {
        clearTimeout(macroTimer);
        macroTimer = null;
    }
    clickHistory = [];
}

// ëª¨ë‹¬ ë‹«í˜ íƒ€ì´ë¨¸ (5ì´ˆ)
function resetMacroCloseTimer() {
    if (macroTimer) clearTimeout(macroTimer);
    macroTimer = setTimeout(() => {
        closeMacroModal();
    }, 30000);
}

// ëª¨ë‹¬ì´ ì—´ë¦° ë™ì•ˆ í´ë¦­ ë°œìƒ ì‹œ 5ì´ˆ ë¦¬ì…‹
document.addEventListener("click", () => {
    if (macroActive) {
        resetMacroCloseTimer();
    }
});

// í¬ì¸íŠ¸ íšë“ ë²„íŠ¼ í´ë¦­
earnPointsBtn.addEventListener('click', () => {
    if (isGachaActive) return; // ë½‘ê¸° ì§„í–‰ ì¤‘ì´ë©´ ë¬´ì‹œ

    const now = Date.now();
    clickHistory.push(now);

    // ìµœê·¼ 3ì´ˆê°„ í´ë¦­ë§Œ ìœ ì§€
    clickHistory = clickHistory.filter(t => now - t <= 3000);

    // ë§¤í¬ë¡œ ì¡°ê±´: 3ì´ˆê°„ 64íšŒ ì´ìƒ í´ë¦­
    if (clickHistory.length >= 51) {
        openMacroModal();
        return; // ëª¨ë‹¬ì´ ì—´ë ¤ ìˆìœ¼ë©´ í¬ì¸íŠ¸ íšë“ ì¤‘ë‹¨
    }

    // ëª¨ë‹¬ì´ ì•ˆ ë–  ìˆì„ ë•Œë§Œ í¬ì¸íŠ¸ ì§€ê¸‰
    if (!macroActive) {
        const earnedPoints = Math.round((1 + chorus) * multiple);
        points += earnedPoints;

        // íœ˜ê´‘ ì²´í¬
        if (window.totalLux > 0) {
            if (Math.random() * 100 < window.totalLux) {
                prisms += 1;
                updateDisplay();
                autoSave(); // ìë™ ì €ì¥
                showMessage(`${earnedPoints} í¬ì¸íŠ¸ + íœ˜ê´‘ìœ¼ë¡œ í”„ë¦¬ì¦˜ 1ê°œ íšë“!`, 'text-purple-300');
                return;
            }
        }

        updateDisplay();
        autoSave(); // ìë™ ì €ì¥
        showMessage(`${earnedPoints} í¬ì¸íŠ¸ë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤!`, 'text-blue-300');
    }
});

        // ìƒì  ë²„íŠ¼ í´ë¦­
        shopBtn.addEventListener('click', () => {
            if (isGachaActive) return; // ë½‘ê¸° ì§„í–‰ ì¤‘ì´ë©´ ë¬´ì‹œ
            openShop();
        });

        // ì¸ë²¤í† ë¦¬ ë²„íŠ¼ í´ë¦­
        inventoryBtn.addEventListener('click', () => {
            if (isGachaActive) return; // ë½‘ê¸° ì§„í–‰ ì¤‘ì´ë©´ ë¬´ì‹œ
            openInventory();
        });

        // ì„¤ì • ë²„íŠ¼ í´ë¦­
        document.getElementById('settingsBtn').addEventListener('click', () => {
            if (isGachaActive) return; // ë½‘ê¸° ì§„í–‰ ì¤‘ì´ë©´ ë¬´ì‹œ
            openSettings();
        });

        // ìƒì  ì—´ê¸°
        function openShop() {
            const shopScreen = document.getElementById('shopScreen');
            shopScreen.style.opacity = '1';
            shopScreen.style.pointerEvents = 'auto';
        }

        // ìƒì  ë‹«ê¸°
        document.getElementById('closeShopBtn').addEventListener('click', () => {
            const shopScreen = document.getElementById('shopScreen');
            shopScreen.style.opacity = '0';
            shopScreen.style.pointerEvents = 'none';
        });

        // ì›ì„ ì±„êµ´ì¥ ì—´ê¸°
        function openGachaShop() {
            const shopScreen = document.getElementById('shopScreen');
            const gachaShopScreen = document.getElementById('gachaShopScreen');
            
            shopScreen.style.opacity = '0';
            shopScreen.style.pointerEvents = 'none';
            
            setTimeout(() => {
                gachaShopScreen.style.opacity = '1';
                gachaShopScreen.style.pointerEvents = 'auto';
            }, 300);
        }

        // ì›ì„ ì±„êµ´ì¥ ë‹«ê¸°
        document.getElementById('closeGachaShopBtn').addEventListener('click', () => {
            const gachaShopScreen = document.getElementById('gachaShopScreen');
            gachaShopScreen.style.opacity = '0';
            gachaShopScreen.style.pointerEvents = 'none';
        });

        // ë³¼ë¥¨ ìƒì  ì—´ê¸°
        function openVolumeShop() {
            const shopScreen = document.getElementById('shopScreen');
            const volumeShopScreen = document.getElementById('volumeShopScreen');
            
            shopScreen.style.opacity = '0';
            shopScreen.style.pointerEvents = 'none';
            
            setTimeout(() => {
                volumeShopScreen.style.opacity = '1';
                volumeShopScreen.style.pointerEvents = 'auto';
                updateVolumeShopDisplay();
            }, 300);
        }

        // ë³¼ë¥¨ ìƒì  ë‹«ê¸°
        document.getElementById('closeVolumeShopBtn').addEventListener('click', () => {
            const volumeShopScreen = document.getElementById('volumeShopScreen');
            volumeShopScreen.style.opacity = '0';
            volumeShopScreen.style.pointerEvents = 'none';
        });

        // ì¸ë²¤í† ë¦¬ ì—´ê¸°
        function openInventory() {
            const inventoryScreen = document.getElementById('inventoryScreen');
            inventoryScreen.style.opacity = '1';
            inventoryScreen.style.pointerEvents = 'auto';
            updateInventoryDisplay();
            
            // ì²« ë²ˆì§¸ ë³´ì„ì´ ìˆìœ¼ë©´ ìë™ìœ¼ë¡œ ì„ íƒí•˜ì—¬ ìƒì„¸ ì •ë³´ í‘œì‹œ
            const firstGemId = Object.keys(inventory)[0];
            if (firstGemId) {
                showGemDetails(firstGemId);
            }
        }

        // ì¸ë²¤í† ë¦¬ ë‹«ê¸°
        document.getElementById('closeInventoryBtn').addEventListener('click', () => {
            const inventoryScreen = document.getElementById('inventoryScreen');
            inventoryScreen.style.opacity = '0';
            inventoryScreen.style.pointerEvents = 'none';
        });

        // ì„¤ì • ì—´ê¸°
        function openSettings() {
            const settingsScreen = document.getElementById('settingsScreen');
            settingsScreen.style.opacity = '1';
            settingsScreen.style.pointerEvents = 'auto';
        }

        // ì„¤ì • ë‹«ê¸°
        document.getElementById('closeSettingsBtn').addEventListener('click', () => {
            const settingsScreen = document.getElementById('settingsScreen');
            settingsScreen.style.opacity = '0';
            settingsScreen.style.pointerEvents = 'none';
        });

        // ë³¼ë¥¨ ìƒì  í™”ë©´ ì—…ë°ì´íŠ¸
        function updateVolumeShopDisplay() {
            // ë©€í‹° ë³¼ë¥¨ ìƒíƒœ ì—…ë°ì´íŠ¸
            const multiStatus = document.getElementById('multiVolumeStatus');
            const multiBtn = document.getElementById('buyMultiVolumeBtn');
            if (volumes.multi) {
                multiStatus.textContent = 'ë³´ìœ  ì¤‘';
                multiStatus.className = 'text-xs text-green-400 mt-1';
                multiBtn.textContent = 'ë³´ìœ  ì¤‘';
                multiBtn.disabled = true;
                multiBtn.className = 'bg-gray-500 px-4 py-2 rounded-full text-white font-bold opacity-50 cursor-not-allowed';
            }

            // ì½”ëŸ¬ìŠ¤ ë³¼ë¥¨ ìƒíƒœ ì—…ë°ì´íŠ¸
            const chorusStatus = document.getElementById('chorusVolumeStatus');
            const chorusBtn = document.getElementById('buyChorusVolumeBtn');
            if (volumes.chorus) {
                chorusStatus.textContent = 'ë³´ìœ  ì¤‘';
                chorusStatus.className = 'text-xs text-green-400 mt-1';
                chorusBtn.textContent = 'ë³´ìœ  ì¤‘';
                chorusBtn.disabled = true;
                chorusBtn.className = 'bg-gray-500 px-4 py-2 rounded-full text-white font-bold opacity-50 cursor-not-allowed';
            }

            // ëŸ­ìŠ¤ ë³¼ë¥¨ ìƒíƒœ ì—…ë°ì´íŠ¸
            const luxStatus = document.getElementById('luxVolumeStatus');
            const luxBtn = document.getElementById('buyLuxVolumeBtn');
            if (volumes.lux) {
                luxStatus.textContent = 'ë³´ìœ  ì¤‘';
                luxStatus.className = 'text-xs text-green-400 mt-1';
                luxBtn.textContent = 'ë³´ìœ  ì¤‘';
                luxBtn.disabled = true;
                luxBtn.className = 'bg-gray-500 px-4 py-2 rounded-full text-white font-bold opacity-50 cursor-not-allowed';
            }
        }

        // ë³¼ë¥¨ êµ¬ë§¤ í•¨ìˆ˜
        function buyVolume(type) {
            if (volumes[type]) {
                showMessage('ì´ë¯¸ ë³´ìœ í•˜ê³  ìˆëŠ” ë³¼ë¥¨ì…ë‹ˆë‹¤!', 'text-yellow-300');
                return;
            }

            let canBuy = false;
            let cost = '';

            switch(type) {
                case 'multi':
                    if (points >= 100000) {
                        points -= 100000;
                        canBuy = true;
                        cost = '100,000 í¬ì¸íŠ¸';
                    }
                    break;
                case 'chorus':
                    if (points >= 55000) {
                        points -= 55000;
                        canBuy = true;
                        cost = '55,000 í¬ì¸íŠ¸';
                    }
                    break;
                case 'lux':
                    // ì „ì„¤ ì´ìƒ ë³´ì„ í™•ì¸
                    const legendaryGems = [];
                    Object.keys(inventory).forEach(gemId => {
                        const grade = getGemGrade(gemId);
                        if ((grade === 'ì „ì„¤' || grade === 'ìœ ë‹ˆí¬' || grade === 'ìŠ¤í˜ì…œ') && inventory[gemId] >= 2) {
                            legendaryGems.push(gemId);
                        }
                    });

                    if (prisms >= 100 && legendaryGems.length > 0) {
                        // ì‚¬ìš©ìê°€ ë³´ì„ì„ ì„ íƒí•˜ë„ë¡ í•¨
                        const selectedGemId = selectLegendaryGemForLux(legendaryGems);
                        if (selectedGemId) {
                            prisms -= 100;
                            inventory[selectedGemId]--;
                            canBuy = true;
                            const selectedGem = gemData[selectedGemId];
                            cost = `100 í”„ë¦¬ì¦˜ + ${selectedGem.name} 1ê°œ`;
                        } else {
                            return; // ì‚¬ìš©ìê°€ ì·¨ì†Œí•œ ê²½ìš°
                        }
                    } else {
                        if (prisms < 100) {
                            showMessage('í”„ë¦¬ì¦˜ì´ ë¶€ì¡±í•©ë‹ˆë‹¤! (100 í”„ë¦¬ì¦˜ í•„ìš”)', 'text-red-300');
                        } else {
                            showMessage('ì „ì„¤ ì´ìƒ ë³´ì„ì´ 2ê°œ ì´ìƒ í•„ìš”í•©ë‹ˆë‹¤!', 'text-red-300');
                        }
                        return;
                    }
                    break;
            }

            if (canBuy) {
                volumes[type] = true;
                maxSlots++;
                updateDisplay();
                updateVolumeShopDisplay();
                autoSave();
                showMessage(`${getVolumeKoreanName(type)}ì„(ë¥¼) êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤! (${cost})`, 'text-green-300');
            } else {
                showMessage('ì¬í™”ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!', 'text-red-300');
            }
        }

        // ë³¼ë¥¨ í•œêµ­ì–´ ì´ë¦„ ë°˜í™˜
        function getVolumeKoreanName(type) {
            switch(type) {
                case 'multi': return 'ë©€í‹° ë³¼ë¥¨';
                case 'chorus': return 'ì½”ëŸ¬ìŠ¤ ë³¼ë¥¨';
                case 'lux': return 'ëŸ­ìŠ¤ ë³¼ë¥¨';
                default: return 'ë³¼ë¥¨';
            }
        }

        // ëŸ­ìŠ¤ ë³¼ë¥¨ìš© ì „ì„¤ ë³´ì„ ì„ íƒ í•¨ìˆ˜
        function selectLegendaryGemForLux(legendaryGems) {
            let message = 'ëŸ­ìŠ¤ ë³¼ë¥¨ êµ¬ë§¤ì— ì‚¬ìš©í•  ë³´ì„ì„ ì„ íƒí•˜ì„¸ìš”:\n\n';
            legendaryGems.forEach((gemId, index) => {
                const gem = gemData[gemId];
                const count = inventory[gemId];
                message += `${index + 1}. ${gem.name} (${count}ê°œ ë³´ìœ )\n`;
            });
            message += '\në²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì·¨ì†Œí•˜ë ¤ë©´ 0):';
            
            const choice = prompt(message);
            const choiceNum = parseInt(choice);
            
            if (choiceNum >= 1 && choiceNum <= legendaryGems.length) {
                return legendaryGems[choiceNum - 1];
            }
            
            return null; // ì·¨ì†Œ ë˜ëŠ” ì˜ëª»ëœ ì…ë ¥
        }

        // ë³¼ë¥¨ ìƒì  ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™”
        function resetVolumeShopButtons() {
            // ë©€í‹° ë³¼ë¥¨ ë²„íŠ¼ ì´ˆê¸°í™”
            const multiStatus = document.getElementById('multiVolumeStatus');
            const multiBtn = document.getElementById('buyMultiVolumeBtn');
            multiStatus.textContent = 'ë¯¸ë³´ìœ ';
            multiStatus.className = 'text-xs text-gray-400 mt-1';
            multiBtn.textContent = 'êµ¬ë§¤';
            multiBtn.disabled = false;
            multiBtn.className = 'bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 px-4 py-2 rounded-full text-white font-bold transition-all duration-300';

            // ì½”ëŸ¬ìŠ¤ ë³¼ë¥¨ ë²„íŠ¼ ì´ˆê¸°í™”
            const chorusStatus = document.getElementById('chorusVolumeStatus');
            const chorusBtn = document.getElementById('buyChorusVolumeBtn');
            chorusStatus.textContent = 'ë¯¸ë³´ìœ ';
            chorusStatus.className = 'text-xs text-gray-400 mt-1';
            chorusBtn.textContent = 'êµ¬ë§¤';
            chorusBtn.disabled = false;
            chorusBtn.className = 'bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 px-4 py-2 rounded-full text-white font-bold transition-all duration-300';

            // ëŸ­ìŠ¤ ë³¼ë¥¨ ë²„íŠ¼ ì´ˆê¸°í™”
            const luxStatus = document.getElementById('luxVolumeStatus');
            const luxBtn = document.getElementById('buyLuxVolumeBtn');
            luxStatus.textContent = 'ë¯¸ë³´ìœ ';
            luxStatus.className = 'text-xs text-gray-400 mt-1';
            luxBtn.textContent = 'êµ¬ë§¤';
            luxBtn.disabled = false;
            luxBtn.className = 'bg-gradient-to-r from-yellow-400 to-pink-500 hover:from-yellow-500 hover:to-pink-600 px-4 py-2 rounded-full text-white font-bold transition-all duration-300';
        }

        // ì¸ë²¤í† ë¦¬ í™”ë©´ ì—…ë°ì´íŠ¸
        // ì¸ë²¤í† ë¦¬ í™”ë©´ ì—…ë°ì´íŠ¸
function updateInventoryDisplay() {
    const gemList = document.getElementById('gemList');
    gemList.innerHTML = '';

    // ë“±ê¸‰ ìˆœì„œ ì •ì˜
    const gradeOrder = ['ì¼ë°˜', 'í¬ê·€', 'ì—í”½', 'ì „ì„¤', 'ìœ ë‹ˆí¬', 'ìŠ¤í˜ì…œ', 'ì´ë²¤íŠ¸'];

    // ë³´ì„ ID ì •ë ¬ (ë“±ê¸‰ > ì´ë¦„ ìˆœ)
    const sortedGemIds = Object.keys(inventory).sort((a, b) => {
        const gradeA = getGemGrade(a);
        const gradeB = getGemGrade(b);

        const gradeIndexA = gradeOrder.indexOf(gradeA);
        const gradeIndexB = gradeOrder.indexOf(gradeB);

        // ë“±ê¸‰ ìš°ì„  ë¹„êµ
        if (gradeIndexA !== gradeIndexB) {
            return gradeIndexA - gradeIndexB;
        }

        // ê°™ì€ ë“±ê¸‰ì´ë©´ ì´ë¦„ìˆœ
        return gemData[a].name.localeCompare(gemData[b].name, 'ko');
    });

    // ì •ë ¬ëœ ìˆœì„œëŒ€ë¡œ í‘œì‹œ
    sortedGemIds.forEach(gemId => {
        const gem = gemData[gemId];
        const count = inventory[gemId];
        const isEquipped = equippedGems.includes(parseInt(gemId));

        const gemElement = document.createElement('div');
        gemElement.className = `bg-white bg-opacity-10 hover:bg-opacity-20 rounded-lg p-3 cursor-pointer transition-all duration-300 text-center relative ${isEquipped ? 'ring-2 ring-yellow-400' : ''}`;
        gemElement.innerHTML = `
            <div class="text-2xl mb-1">${gem.emoji}</div>
            <div class="text-xs text-white">${gem.name}</div>
            <div class="absolute top-1 right-1 bg-blue-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">${count}</div>
            ${isEquipped ? '<div class="text-xs text-yellow-400 mt-1">ì¥ì°©ë¨</div>' : ''}
        `;
        gemElement.addEventListener('click', () => showGemDetails(gemId));
        gemList.appendChild(gemElement);
    });

    if (sortedGemIds.length === 0) {
        gemList.innerHTML = '<div class="col-span-full text-center text-gray-400 py-8">ë³´ì„ì´ ì—†ìŠµë‹ˆë‹¤</div>';
    }

    // ì¥ì°© ìŠ¬ë¡¯ ì—…ë°ì´íŠ¸
    updateEquipmentSlots();
}

        // ì¥ì°© ìŠ¬ë¡¯ ì—…ë°ì´íŠ¸
        function updateEquipmentSlots() {
            const equipmentSlots = document.getElementById('equipmentSlots');
            const slotInfo = document.getElementById('slotInfo');
            
            equipmentSlots.innerHTML = '';
            
            // ë³¼ë¥¨ë³„ ìŠ¬ë¡¯ í‘œì‹œ
            const volumeTypes = [
                { key: 'multi', name: 'ë©€í‹° ë³¼ë¥¨', available: true }, // ê¸°ë³¸ ìŠ¬ë¡¯
                { key: 'multi', name: 'ë©€í‹° ë³¼ë¥¨', available: volumes.multi },
                { key: 'chorus', name: 'ì½”ëŸ¬ìŠ¤ ë³¼ë¥¨', available: volumes.chorus },
                { key: 'lux', name: 'ëŸ­ìŠ¤ ë³¼ë¥¨', available: volumes.lux }
            ];
            
            for (let i = 0; i < maxSlots; i++) {
                const slot = document.createElement('div');
                slot.className = 'bg-white bg-opacity-10 rounded-lg p-3 text-center cursor-pointer hover:bg-opacity-20 transition-all duration-300';
                
                let volumeName = 'ê¸°ë³¸ ìŠ¬ë¡¯';
                if (i === 1 && volumes.multi) volumeName = 'ë©€í‹° ë³¼ë¥¨';
                else if (i === 2 && volumes.chorus) volumeName = 'ì½”ëŸ¬ìŠ¤ ë³¼ë¥¨';
                else if (i === 3 && volumes.lux) volumeName = 'ëŸ­ìŠ¤ ë³¼ë¥¨';
                else if (i > 0) {
                    // ë³¼ë¥¨ ìˆœì„œëŒ€ë¡œ ì´ë¦„ í• ë‹¹
                    if (volumes.multi && i === 1) volumeName = 'ë©€í‹° ë³¼ë¥¨';
                    else if (volumes.chorus && ((volumes.multi && i === 2) || (!volumes.multi && i === 1))) volumeName = 'ì½”ëŸ¬ìŠ¤ ë³¼ë¥¨';
                    else if (volumes.lux) {
                        let luxSlotIndex = 1;
                        if (volumes.multi) luxSlotIndex++;
                        if (volumes.chorus) luxSlotIndex++;
                        if (i === luxSlotIndex) volumeName = 'ëŸ­ìŠ¤ ë³¼ë¥¨';
                    }
                }
                
                if (equippedGems[i]) {
                    const gem = gemData[equippedGems[i]];
                    slot.innerHTML = `
                        <div class="text-xs text-blue-300 mb-1">${volumeName}</div>
                        <div class="text-2xl mb-1">${gem.emoji}</div>
                        <div class="text-xs text-white">${gem.name}</div>
                    `;
                    slot.onclick = () => unequipGemFromSlot(i);
                } else {
                    slot.innerHTML = `
                        <div class="text-xs text-blue-300 mb-1">${volumeName}</div>
                        <div class="text-2xl mb-1 opacity-50">ğŸ’</div>
                        <div class="text-xs text-gray-400">ë¹„ì–´ìˆìŒ</div>
                    `;
                }
                
                equipmentSlots.appendChild(slot);
            }
            
            slotInfo.textContent = `ìŠ¬ë¡¯ ${equippedGems.length}/${maxSlots} ì‚¬ìš© ì¤‘`;
        }

        // ë³´ì„ ìƒì„¸ ì •ë³´ í‘œì‹œ
        function showGemDetails(gemId) {
            const gem = gemData[gemId];
            const gemDetails = document.getElementById('gemDetails');
            const count = inventory[gemId] || 0;
            
            // ìŠ¤íƒ¯ í…ìŠ¤íŠ¸ ìƒì„±
            let statsText = `ì½”ëŸ¬ìŠ¤ +${gem.chorus}`;
            if (gem.multiple > 1) {
                statsText += ` | x${gem.multiple}`;
            }
            if (gem.lux) {
                statsText += ` | íœ˜ê´‘ ${gem.lux}%`;
            }
            
            const isEquipped = equippedGems.includes(parseInt(gemId));
            const canExtract = count >= 2;
            const canEquip = !isEquipped && equippedGems.length < maxSlots;
            
            gemDetails.innerHTML = `
                <div class="text-6xl mb-4">${gem.emoji}</div>
                <h3 class="text-xl font-bold mb-2">${gem.name}</h3>
                <div class="text-blue-300 font-medium mb-2">${statsText}</div>
                <div class="text-gray-400 text-sm mb-4">ë³´ìœ  ê°œìˆ˜: ${count}ê°œ</div>
                <p class="text-gray-300 mb-4">${gem.description}</p>
                <div class="flex gap-2 justify-center flex-wrap">
                    ${isEquipped ? 
                        `<button onclick="unequipGem(${gemId})" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-full text-white font-bold transition-all duration-300">ì¥ì°© í•´ì œ</button>` :
                        canEquip ? 
                            `<button onclick="equipGem(${gemId})" class="bg-green-500 hover:bg-green-600 px-4 py-2 rounded-full text-white font-bold transition-all duration-300">ì¥ì°©í•˜ê¸°</button>` :
                            '<button class="bg-gray-500 px-4 py-2 rounded-full text-white font-bold opacity-50 cursor-not-allowed" disabled>ìŠ¬ë¡¯ ë¶€ì¡±</button>'
                    }
                    ${canExtract ? 
                        `<button onclick="extractGem(${gemId})" class="bg-purple-500 hover:bg-purple-600 px-4 py-2 rounded-full text-white font-bold transition-all duration-300">ì¶”ì¶œ</button>` :
                        '<button class="bg-gray-500 px-4 py-2 rounded-full text-white font-bold opacity-50 cursor-not-allowed" disabled>ì¶”ì¶œ ë¶ˆê°€</button>'
                    }
                </div>
            `;
        }

        // ë½‘ê¸° ì‹œì‘ í•¨ìˆ˜ (ìƒì ì—ì„œ í˜¸ì¶œ)
        function startGacha(type, count = 1) {
            if (isGachaActive) return; // ë½‘ê¸° ì§„í–‰ ì¤‘ì´ë©´ ë¬´ì‹œ
            
            let cost, currency, hasEnough;
            
            switch(type) {
                case 'beginner':
                    cost = count === 10 ? 100 : 10;
                    currency = 'points';
                    hasEnough = points >= cost;
                    break;
                case 'normal':
                    cost = count === 10 ? 50 : 5;
                    currency = 'prisms';
                    hasEnough = prisms >= cost;
                    break;
                case 'premium':
                    cost = count === 10 ? 300 : 30;
                    currency = 'prisms';
                    hasEnough = prisms >= cost;
                    break;
                case 'luxury':
                    cost = count === 10 ? 500 : 50;
                    currency = 'prisms';
                    hasEnough = prisms >= cost;
                    break;
                case 'pointer':
                    cost = count === 10 ? 1000000 : 100000;
                    currency = 'points';
                    hasEnough = points >= cost;
                    break;
                case 'event':
                    cost = count === 10 ? 500000 : 50000;
                    currency = 'points';
                    if (cost === 50000) {
                        hasEnough = points >= cost && (inventory[23] || 0) >= 2;
                        break;
                    } else {
                        hasEnough = points >= cost && (inventory[23] || 0) >= 11;
                        break;
                    }
            }
            
            if (hasEnough) {
                if (type === 'event') {
                    // í¬ì¸íŠ¸ ì°¨ê°
                    points -= cost;
                    // ë³´ì„ 1ê°œ ì†Œëª¨
                    if (cost === 500000) {
                        inventory[23] -= 10;    
                    } else {
                        inventory[23] -= 1;
                    }
                } else if (currency === 'points') {
                    points -= cost;
                } else {
                    prisms -= cost;
                }
                updateDisplay();
                autoSave(); // ìë™ ì €ì¥
                
                // ëª¨ë“  ìƒì  í™”ë©´ ë‹«ê¸°
                const shopScreen = document.getElementById('shopScreen');
                const gachaShopScreen = document.getElementById('gachaShopScreen');
                shopScreen.style.opacity = '0';
                shopScreen.style.pointerEvents = 'none';
                gachaShopScreen.style.opacity = '0';
                gachaShopScreen.style.pointerEvents = 'none';
                
                // ë½‘ê¸° íƒ€ì…ê³¼ íšŸìˆ˜ ì €ì¥í•˜ê³  ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
                window.currentGachaType = type;
                window.currentGachaCount = count;
                startGachaAnimation();
            } else {
                if (type === 'event') {
                    showMessage(`âŒ ì´ë²¤íŠ¸ ë½‘ê¸°ì—ëŠ” í¬ì¸íŠ¸ ${cost}ì™€ ë³´ì„(ID:23) 2ê°œ ì´ìƒì´ í•„ìš”í•©ë‹ˆë‹¤!`, 'text-red-300');
                } else {
                    const currencyName = currency === 'points' ? 'í¬ì¸íŠ¸' : 'í”„ë¦¬ì¦˜';
                    showMessage(`${currencyName}ì´ ë¶€ì¡±í•©ë‹ˆë‹¤! (${cost} ${currencyName} í•„ìš”)`, 'text-red-300');
                }
            }
        }

        // ë½‘ê¸° ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
        function startGachaAnimation() {
            isGachaActive = true; // ë½‘ê¸° ì§„í–‰ ìƒíƒœë¡œ ë³€ê²½
            
            const mainUI = document.getElementById('mainUI');
            const gachaScreen = document.getElementById('gachaScreen');
            const gemstone = document.getElementById('gemstone');
            const gachaText = document.getElementById('gachaText');
            
            // ë©”ì¸ UI ìˆ¨ê¸°ê³  ë½‘ê¸° í™”ë©´ í‘œì‹œ
            mainUI.style.opacity = '0';
            gachaScreen.style.opacity = '1';
            gachaScreen.style.pointerEvents = 'auto';
            
            // í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            if (window.currentGachaCount === 10) {
                gachaText.textContent = 'ì›ì„ì„ í´ë¦­í•˜ì„¸ìš”! (10íšŒ ë½‘ê¸°)';
            } else {
                gachaText.textContent = 'ì›ì„ì„ í´ë¦­í•˜ì„¸ìš”!';
            }
            
            // ì›ì„ í´ë¦­ ì´ë²¤íŠ¸ (ê¸°ì¡´ ì´ë²¤íŠ¸ ì œê±° í›„ ìƒˆë¡œ ì¶”ê°€)
            gemstone.onclick = null;
            gemstone.onclick = () => {
                if (window.currentGachaCount === 10) {
                    performMultipleGacha();
                } else {
                    revealGrade();
                }
            };
        }

        // ë“±ê¸‰ë³„ ë³´ì„ ë³´ìƒ ì„¤ì • (ìœ ì§€ë³´ìˆ˜ ì‰½ê²Œ í•˜ê¸° ìœ„í•´ ë³„ë„ ê°ì²´ë¡œ ê´€ë¦¬)
        // ìƒˆ ë³´ì„ì„ ì¶”ê°€í•  ë•ŒëŠ” gemDataì— ë¨¼ì € ì¶”ê°€í•˜ê³ , ì—¬ê¸°ì„œ í•´ë‹¹ ë“±ê¸‰ ë°°ì—´ì— IDë¥¼ ì¶”ê°€í•˜ì„¸ìš”
        // ì˜ˆì‹œ: 16ë²ˆ ë³´ì„ì„ ì „ì„¤ ë“±ê¸‰ì— ì¶”ê°€í•˜ë ¤ë©´ 'ì „ì„¤': [10, 11, 12, 16] ì´ë ‡ê²Œ ìˆ˜ì •
        const gemRewards = {
            'ì¼ë°˜': [1, 2, 3],
            'í¬ê·€': [4, 5, 6], 
            'ì—í”½': [7, 8, 9, 20, 23],
            'ì „ì„¤': [10, 11, 12],
            'ìœ ë‹ˆí¬': [13, 14, 15, 16],
            'ìŠ¤í˜ì…œ' : [17, 18, 19, 21, 22],
            'ì´ë²¤íŠ¸' : [24, 25, 26]
        };

        // 10íšŒ ë½‘ê¸° ì‹¤í–‰
        function performMultipleGacha() {
            currentGachaResults = [];
            
            // 10ë²ˆ ë½‘ê¸° ì‹¤í–‰
            for (let i = 0; i < 10; i++) {
                const result = performSingleGacha();
                currentGachaResults.push(result);
            }
            
            // ê°€ì¥ ë†’ì€ ë“±ê¸‰ ì°¾ê¸°
            const gradeOrder = ['ì¼ë°˜', 'í¬ê·€', 'ì—í”½', 'ì „ì„¤', 'ìœ ë‹ˆí¬', 'ìŠ¤í˜ì…œ', 'ì´ë²¤íŠ¸'];
            let highestGrade = 'ì¼ë°˜';
            let highestGradeClass = 'grade-common';
            
            currentGachaResults.forEach(result => {
                const currentIndex = gradeOrder.indexOf(result.grade);
                const highestIndex = gradeOrder.indexOf(highestGrade);
                if (currentIndex > highestIndex) {
                    highestGrade = result.grade;
                    highestGradeClass = result.gradeClass;
                }
            });
            
            // ë“±ê¸‰ ê³µê°œ í™”ë©´ìœ¼ë¡œ ì´ë™ (ê°€ì¥ ë†’ì€ ë“±ê¸‰ë§Œ í‘œì‹œ)
            showGradeReveal(highestGrade, highestGradeClass, true);
        }

        // ë‹¨ì¼ ë½‘ê¸° ì‹¤í–‰ (ë‚´ë¶€ ë¡œì§)
        function performSingleGacha() {
            // ë½‘ê¸° íƒ€ì…ë³„ í™•ë¥  ì„¤ì •
            let grades;
            switch(window.currentGachaType) {
                case 'beginner':
                    grades = [
                        { name: 'ì¼ë°˜', class: 'grade-common', probability: 0.7 },
                        { name: 'í¬ê·€', class: 'grade-rare', probability: 0.2 },
                        { name: 'ì—í”½', class: 'grade-epic', probability: 0.08 },
                        { name: 'ì „ì„¤', class: 'grade-legendary', probability: 0.015 },
                        { name: 'ìœ ë‹ˆí¬', class: 'grade-unique', probability: 0.005 },
                        { name: 'ìŠ¤í˜ì…œ', class: 'grade-special', probability: 0.00 }
                    ];
                    break;
                case 'normal':
                    grades = [
                        { name: 'ì¼ë°˜', class: 'grade-common', probability: 0.5 },
                        { name: 'í¬ê·€', class: 'grade-rare', probability: 0.25 },
                        { name: 'ì—í”½', class: 'grade-epic', probability: 0.15 },
                        { name: 'ì „ì„¤', class: 'grade-legendary', probability: 0.07 },
                        { name: 'ìœ ë‹ˆí¬', class: 'grade-unique', probability: 0.03 },
                        { name: 'ìŠ¤í˜ì…œ', class: 'grade-special', probability: 0.00 }
                    ];
                    break;
                case 'premium':
                    grades = [
                        { name: 'ì¼ë°˜', class: 'grade-common', probability: 0.3 },
                        { name: 'í¬ê·€', class: 'grade-rare', probability: 0.3 },
                        { name: 'ì—í”½', class: 'grade-epic', probability: 0.22 },
                        { name: 'ì „ì„¤', class: 'grade-legendary', probability: 0.12, },
                        { name: 'ìœ ë‹ˆí¬', class: 'grade-unique', probability: 0.05 },
                        { name: 'ìŠ¤í˜ì…œ', class: 'grade-special', probability: 0.01 }
                    ];
                    break;
                case 'luxury':
                    grades = [
                        { name: 'ì¼ë°˜', class: 'grade-common', probability: 0.3 },
                        { name: 'í¬ê·€', class: 'grade-rare', probability: 0.3 },
                        { name: 'ì—í”½', class: 'grade-epic', probability: 0.22 },
                        { name: 'ì „ì„¤', class: 'grade-legendary', probability: 0.1 },
                        { name: 'ìœ ë‹ˆí¬', class: 'grade-unique', probability: 0.05 },
                        { name: 'ìŠ¤í˜ì…œ', class: 'grade-special', probability: 0.01 }
                    ];
                    break;
                case 'pointer':
                    grades = [
                        { name: 'ì¼ë°˜', class: 'grade-common', probability: 0.3 },
                        { name: 'í¬ê·€', class: 'grade-rare', probability: 0.3 },
                        { name: 'ì—í”½', class: 'grade-epic', probability: 0.22 },
                        { name: 'ì „ì„¤', class: 'grade-legendary', probability: 0.1 },
                        { name: 'ìœ ë‹ˆí¬', class: 'grade-unique', probability: 0.05 },
                        { name: 'ìŠ¤í˜ì…œ', class: 'grade-special', probability: 0.01 }
                    ];
                    break;
                case 'event':
                    grades = [
                        { name: 'ì¼ë°˜', class: 'grade-common', probability: 0.3 },
                        { name: 'í¬ê·€', class: 'grade-rare', probability: 0.3 },
                        { name: 'ì—í”½', class: 'grade-epic', probability: 0.22 },
                        { name: 'ì „ì„¤', class: 'grade-legendary', probability: 0.1 },
                        { name: 'ìœ ë‹ˆí¬', class: 'grade-unique', probability: 0.04 },
                        { name: 'ìŠ¤í˜ì…œ', class: 'grade-special', probability: 0.01 },
                        { name: 'ì´ë²¤íŠ¸', class: 'grade-event', probability: 0.01 }
                    ];
                    break;
                default:
                    grades = [
                        { name: 'ì¼ë°˜', class: 'grade-common', probability: 0.5 },
                        { name: 'í¬ê·€', class: 'grade-rare', probability: 0.25 },
                        { name: 'ì—í”½', class: 'grade-epic', probability: 0.15 },
                        { name: 'ì „ì„¤', class: 'grade-legendary', probability: 0.07 },
                        { name: 'ìœ ë‹ˆí¬', class: 'grade-unique', probability: 0.03 },
                        { name: 'ìŠ¤í˜ì…œ', class: 'grade-special', probability: 0.00 }
                    ];
            }

            // í™•ë¥ ì— ë”°ë¥¸ ë“±ê¸‰ ê²°ì •
            const random = Math.random();
            let currentProbability = 0;
            let selectedGrade = grades[0];

            for (const grade of grades) {
                currentProbability += grade.probability;
                if (random <= currentProbability) {
                    selectedGrade = grade;
                    break;
                }
            }

            // ë³´ì„ ì„ íƒ
            let possibleRewards = gemRewards[selectedGrade.name];
            let selectedReward;
            
            // ê´‘ì•ˆì˜ ì›ì„ íŠ¹ë³„ í™•ë¥  ì ìš©
            if (window.currentGachaType === 'luxury') {
                if (selectedGrade.name === 'ì „ì„¤') {
                    const random = Math.random();
                    if (random < 0.6) {
                        selectedReward = 10; // ì˜¤íŒ”
                    } else {
                        selectedReward = possibleRewards[Math.floor(Math.random() * possibleRewards.length)];
                    }
                } else if (selectedGrade.name === 'ìŠ¤í˜ì…œ') {
                    const random = Math.random();
                    if (random < 0.6) {
                        
                        if (random < 0.3) {
                            selectedReward = 22;
                        }
                        else {
                            selectedReward = 21;
                        }
                    } 
                    // else if (0.3 =< random < 0.6) {
                    //    selectedReward = 22; 
                    //}
                    else {
                        selectedReward = possibleRewards[Math.floor(Math.random() * possibleRewards.length)];
                    }
                } else {
                    selectedReward = possibleRewards[Math.floor(Math.random() * possibleRewards.length)];
                }
            } else {
                selectedReward = possibleRewards[Math.floor(Math.random() * possibleRewards.length)];
            }

            return {
                grade: selectedGrade.name,
                gradeClass: selectedGrade.class,
                gemId: selectedReward
            };
        }

        // ë“±ê¸‰ ê²°ì • ë° ê³µê°œ (1íšŒ ë½‘ê¸°ìš©)
        function revealGrade() {
            const result = performSingleGacha();
            window.currentGrade = result.grade;
            window.currentGemId = result.gemId;
            
            showGradeReveal(result.grade, result.gradeClass, false);
        }

        // ë“±ê¸‰ ê³µê°œ í™”ë©´ í‘œì‹œ
        function showGradeReveal(gradeName, gradeClass, isMultiple) {
            const gachaScreen = document.getElementById('gachaScreen');
            const revealScreen = document.getElementById('revealScreen');
            const gradeText = document.getElementById('gradeText');
            const revealMessage = document.getElementById('revealMessage');

            // ë½‘ê¸° í™”ë©´ ìˆ¨ê¸°ê¸°
            gachaScreen.style.opacity = '0';
            gachaScreen.style.pointerEvents = 'none';

            // ë“±ê¸‰ ê³µê°œ í™”ë©´ í‘œì‹œ
            setTimeout(() => {
                revealScreen.style.opacity = '1';
                revealScreen.style.pointerEvents = 'auto';
                revealScreen.className = `fixed inset-0 flex items-center justify-center z-50 transition-all duration-1000 ${gradeClass}`;
                gradeText.textContent = gradeName;
                
                if (isMultiple) {
                    revealMessage.textContent = `ìµœê³  ë“±ê¸‰: ${gradeName}!`;
                } else {
                    revealMessage.textContent = 'ë“±ê¸‰ì´ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤!';
                }
            }, 500);
        }

        // ê³„ì†í•˜ê¸° ë²„íŠ¼ (ë“±ê¸‰ ê³µê°œ -> ë³´ì„ íšë“ í™”ë©´ìœ¼ë¡œ)
        document.getElementById('continueBtn').addEventListener('click', () => {
            if (window.currentGachaCount === 10) {
                showMultipleGemReward();
            } else {
                showSingleGemReward();
            }
        });

        // ë‹¨ì¼ ë³´ì„ íšë“ í™”ë©´ í‘œì‹œ
        function showSingleGemReward() {
            const revealScreen = document.getElementById('revealScreen');
            const gemRewardScreen = document.getElementById('gemRewardScreen');
            const singleReward = document.getElementById('singleReward');
            const multipleReward = document.getElementById('multipleReward');
            const rewardText = document.getElementById('rewardText');
            const rewardGemImage = document.getElementById('rewardGemImage');
            
            // ì¸ë²¤í† ë¦¬ì— ë³´ì„ ì¶”ê°€
            if (inventory[window.currentGemId]) {
                inventory[window.currentGemId]++;
            } else {
                inventory[window.currentGemId] = 1;
            }
            autoSave(); // ìë™ ì €ì¥
            
            // ë³´ì„ ì´ë¯¸ì§€ì™€ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            const gem = gemData[window.currentGemId];
            rewardGemImage.innerHTML = gem.emoji;
            rewardGemImage.className = 'w-24 h-24 sm:w-32 sm:h-32 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-6 shadow-2xl flex items-center justify-center text-3xl sm:text-4xl';
            rewardText.textContent = `${gem.name} íšë“!`;
            
            // ë‹¨ì¼ ë³´ì„ í‘œì‹œ ëª¨ë“œ
            singleReward.classList.remove('hidden');
            multipleReward.classList.add('hidden');
            
            // ë“±ê¸‰ ê³µê°œ í™”ë©´ ìˆ¨ê¸°ê¸°
            revealScreen.style.opacity = '0';
            revealScreen.style.pointerEvents = 'none';
            
            // ë³´ì„ íšë“ í™”ë©´ í‘œì‹œ
            setTimeout(() => {
                gemRewardScreen.style.opacity = '1';
                gemRewardScreen.style.pointerEvents = 'auto';
            }, 500);
        }

        // ë‹¤ì¤‘ ë³´ì„ íšë“ í™”ë©´ í‘œì‹œ
        function showMultipleGemReward() {
            const revealScreen = document.getElementById('revealScreen');
            const gemRewardScreen = document.getElementById('gemRewardScreen');
            const singleReward = document.getElementById('singleReward');
            const multipleReward = document.getElementById('multipleReward');
            const multipleGemGrid = document.getElementById('multipleGemGrid');
            
            // ì¸ë²¤í† ë¦¬ì— ëª¨ë“  ë³´ì„ ì¶”ê°€
            currentGachaResults.forEach(result => {
                if (inventory[result.gemId]) {
                    inventory[result.gemId]++;
                } else {
                    inventory[result.gemId] = 1;
                }
            });
            autoSave(); // ìë™ ì €ì¥
            
            // 10ê°œ ë³´ì„ ê·¸ë¦¬ë“œ ìƒì„±
            multipleGemGrid.innerHTML = '';
            currentGachaResults.forEach(result => {
                const gem = gemData[result.gemId];
                const gemElement = document.createElement('div');
                gemElement.className = 'bg-white bg-opacity-10 rounded-lg p-3 text-center';
                gemElement.innerHTML = `
                    <div class="text-3xl mb-2">${gem.emoji}</div>
                    <div class="text-xs text-white">${gem.name}</div>
                `;
                multipleGemGrid.appendChild(gemElement);
            });
            
            // ë‹¤ì¤‘ ë³´ì„ í‘œì‹œ ëª¨ë“œ
            singleReward.classList.add('hidden');
            multipleReward.classList.remove('hidden');
            
            // ë“±ê¸‰ ê³µê°œ í™”ë©´ ìˆ¨ê¸°ê¸°
            revealScreen.style.opacity = '0';
            revealScreen.style.pointerEvents = 'none';
            
            // ë³´ì„ íšë“ í™”ë©´ í‘œì‹œ
            setTimeout(() => {
                gemRewardScreen.style.opacity = '1';
                gemRewardScreen.style.pointerEvents = 'auto';
            }, 500);
        }

        // ìµœì¢… í™•ì¸ ë²„íŠ¼ (ë³´ì„ íšë“ í™”ë©´ -> ë©”ì¸ UIë¡œ)
        document.getElementById('finalContinueBtn').addEventListener('click', () => {
            const mainUI = document.getElementById('mainUI');
            const revealScreen = document.getElementById('revealScreen');
            const gemRewardScreen = document.getElementById('gemRewardScreen');
            
            // ë³´ì„ íšë“ í™”ë©´ ìˆ¨ê¸°ê¸°
            gemRewardScreen.style.opacity = '0';
            gemRewardScreen.style.pointerEvents = 'none';
            
            // ë©”ì¸ UI ë‹¤ì‹œ í‘œì‹œ
            setTimeout(() => {
                mainUI.style.opacity = '1';
                isGachaActive = false; // ë½‘ê¸° ì™„ë£Œ ìƒíƒœë¡œ ë³€ê²½
                
                // ê²°ê³¼ ì´ˆê¸°í™”
                currentGachaResults = [];
                window.currentGachaCount = 1;
            }, 300);
            
            // ëª¨ë“  í™”ë©´ ì™„ì „íˆ ì´ˆê¸°í™”
            setTimeout(() => {
                revealScreen.className = 'fixed inset-0 flex items-center justify-center z-50 opacity-0 pointer-events-none transition-all duration-1000';
                revealScreen.style.background = '';
                revealScreen.style.animation = '';
                gemRewardScreen.style.opacity = '0';
                gemRewardScreen.style.pointerEvents = 'none';
            }, 1000);
        });

        // ë³´ì„ ì¥ì°© í•¨ìˆ˜
        function equipGem(gemId) {
            if (equippedGems.length >= maxSlots) {
                showMessage('ì¥ì°© ìŠ¬ë¡¯ì´ ë¶€ì¡±í•©ë‹ˆë‹¤!', 'text-red-300');
                return;
            }
            
            if (equippedGems.includes(parseInt(gemId))) {
                showMessage('ì´ë¯¸ ì¥ì°©ëœ ë³´ì„ì…ë‹ˆë‹¤!', 'text-yellow-300');
                return;
            }
            
            equippedGems.push(parseInt(gemId));
            const gem = gemData[gemId];
            
            // ìŠ¤íƒ¯ ì¬ê³„ì‚°
            calculateTotalStats();
            updateEquippedGemDisplay();
            updateInventoryDisplay(); // ì¸ë²¤í† ë¦¬ í™”ë©´ ìƒˆë¡œê³ ì¹¨
            showGemDetails(gemId); // ìƒì„¸ ì •ë³´ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
            autoSave(); // ìë™ ì €ì¥
            showMessage(`${gem.name}ì„(ë¥¼) ì¥ì°©í–ˆìŠµë‹ˆë‹¤!`, 'text-green-300');
        }

        // ë³´ì„ ì¥ì°© í•´ì œ í•¨ìˆ˜ (íŠ¹ì • ë³´ì„)
        function unequipGem(gemId) {
            const index = equippedGems.indexOf(parseInt(gemId));
            if (index > -1) {
                equippedGems.splice(index, 1);
                calculateTotalStats();
                updateEquippedGemDisplay();
                updateInventoryDisplay();
                showGemDetails(gemId);
                autoSave();
                showMessage('ë³´ì„ ì¥ì°©ì„ í•´ì œí–ˆìŠµë‹ˆë‹¤!', 'text-yellow-300');
            }
        }

        // ìŠ¬ë¡¯ì—ì„œ ë³´ì„ í•´ì œ í•¨ìˆ˜
        function unequipGemFromSlot(slotIndex) {
            if (equippedGems[slotIndex]) {
                const gemId = equippedGems[slotIndex];
                equippedGems.splice(slotIndex, 1);
                calculateTotalStats();
                updateEquippedGemDisplay();
                updateInventoryDisplay();
                autoSave();
                showMessage('ë³´ì„ ì¥ì°©ì„ í•´ì œí–ˆìŠµë‹ˆë‹¤!', 'text-yellow-300');
            }
        }

        // ì „ì²´ ìŠ¤íƒ¯ ê³„ì‚° í•¨ìˆ˜
        function calculateTotalStats() {
            let totalChorus = 0;
            let totalMultiple = 0;
            let totalLux = 0;
            
            equippedGems.forEach(gemId => {
                const gem = gemData[gemId];
                if (gem) {
                    // ì½”ëŸ¬ìŠ¤ ê³„ì‚°
                    if (volumes.chorus) {
                        totalChorus += gem.chorus;
                    } else {
                        totalChorus = Math.max(totalChorus, gem.chorus); // ì½”ëŸ¬ìŠ¤ ë³¼ë¥¨ì´ ì—†ìœ¼ë©´ ìµœëŒ€ê°’ë§Œ
                    }
                    
                    // ë°°ìœ¨ ê³„ì‚°
                    if (volumes.multi) {
                        totalMultiple += (gem.multiple - 1); // í•©ì—°ì‚° (1.2 + 1.3 = 1.5)
                    } else {
                        totalMultiple = Math.max(totalMultiple, gem.multiple - 1); // ë©€í‹° ë³¼ë¥¨ì´ ì—†ìœ¼ë©´ ìµœëŒ€ê°’ë§Œ
                    }
                    
                    // íœ˜ê´‘ ê³„ì‚°
                    if (volumes.lux && gem.lux) {
                        totalLux += gem.lux;
                    } else if (gem.lux) {
                        totalLux = Math.max(totalLux, gem.lux); // ëŸ­ìŠ¤ ë³¼ë¥¨ì´ ì—†ìœ¼ë©´ ìµœëŒ€ê°’ë§Œ
                    }
                }
            });
            
            // ê¸°ë³¸ê°’ ì„¤ì •
            chorus = Math.max(1, totalChorus);
            multiple = 1 + totalMultiple;
            
            // íœ˜ê´‘ì€ ë³„ë„ë¡œ ê³„ì‚° (í¬ì¸íŠ¸ íšë“ ì‹œ ì‚¬ìš©)
            window.totalLux = totalLux;
        }

        // ë³´ì„ ì¶”ì¶œ í•¨ìˆ˜
        function extractGem(gemId) {
            const gem = gemData[gemId];
            const count = inventory[gemId];
            
            if (count >= 2) {
                inventory[gemId]--;
                
                // ë³´ì„ ë“±ê¸‰ë³„ í”„ë¦¬ì¦˜ íšë“ëŸ‰ ì„¤ì •
                const grade = getGemGrade(gemId);
                let prismReward;
                switch(grade) {
                    case 'ì¼ë°˜': prismReward = 1; break;
                    case 'í¬ê·€': prismReward = 3; break;
                    case 'ì—í”½': prismReward = 8; break;
                    case 'ì „ì„¤': prismReward = 20; break;
                    case 'ìœ ë‹ˆí¬': prismReward = 60; break;
                    case 'ìŠ¤í˜ì…œ': prismReward = 100; break;
                    default: prismReward = 1; break;
                }
                
                prisms += prismReward;
                updateDisplay();
                updateInventoryDisplay();
                showGemDetails(gemId); // ìƒì„¸ ì •ë³´ ìƒˆë¡œê³ ì¹¨
                autoSave(); // ìë™ ì €ì¥
                showMessage(`${gem.name}ì„(ë¥¼) ì¶”ì¶œí•˜ì—¬ í”„ë¦¬ì¦˜ ${prismReward}ê°œë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤!`, 'text-purple-300');
            }
        }

        // ì¥ì°©ëœ ë³´ì„ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateEquippedGemDisplay() {
            const equippedGemDisplay = document.getElementById('equippedGemDisplay');
            const equippedGemIcon = document.getElementById('equippedGemIcon');
            const equippedGemName = document.getElementById('equippedGemName');
            const equippedGemStats = document.getElementById('equippedGemStats');

            if (equippedGems.length > 0) {
                // ì—¬ëŸ¬ ë³´ì„ì´ ì¥ì°©ëœ ê²½ìš° ì²« ë²ˆì§¸ ë³´ì„ ì •ë³´ í‘œì‹œí•˜ê³  ê°œìˆ˜ í‘œì‹œ
                const firstGem = gemData[equippedGems[0]];
                
                if (equippedGems.length === 1) {
                    equippedGemIcon.textContent = firstGem.emoji;
                    equippedGemName.textContent = firstGem.name;
                } else {
                    equippedGemIcon.textContent = 'ğŸ’';
                    equippedGemName.textContent = `${equippedGems.length}ê°œ ì¥ì°©ë¨`;
                }
                
                let statsText = `ì½”ëŸ¬ìŠ¤ +${chorus}`;
                if (multiple > 1) {
                    statsText += ` | x${multiple.toFixed(1)}`;
                }
                if (window.totalLux > 0) {
                    statsText += ` | íœ˜ê´‘ ${window.totalLux.toFixed(1)}%`;
                }
                equippedGemStats.textContent = statsText;
                
                equippedGemDisplay.style.opacity = '1';
            } else {
                equippedGemDisplay.style.opacity = '0';
            }
        }

        // ë¡œì»¬ ì €ì¥ì†Œ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function saveGameData() {
            const gameData = {
                points: points,
                prisms: prisms,
                inventory: inventory,
                equippedGems: equippedGems,
                volumes: volumes,
                maxSlots: maxSlots,
                chorus: chorus,
                multiple: multiple,
                lastSaved: Date.now()
            };
            localStorage.setItem('gemGachaGame', JSON.stringify(gameData));
        }

        function loadGameData() {
            try {
                const savedData = localStorage.getItem('gemGachaGame');
                if (savedData) {
                    const gameData = JSON.parse(savedData);
                    points = gameData.points || 0;
                    prisms = gameData.prisms || 0;
                    inventory = gameData.inventory || {};
                    equippedGems = gameData.equippedGems || [];
                    volumes = gameData.volumes || { multi: false, chorus: false, lux: false };
                    maxSlots = gameData.maxSlots || 1;
                    
                    // ìŠ¤íƒ¯ ì¬ê³„ì‚°
                    calculateTotalStats();
                    
                    showMessage('ì €ì¥ëœ ê²Œì„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!', 'text-green-300');
                    return true;
                }
            } catch (error) {
                console.error('ê²Œì„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                showMessage('ì €ì¥ëœ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'text-red-300');
            }
            return false;
        }

        function resetGameData() {
            if (confirm('ì •ë§ë¡œ ê²Œì„ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                localStorage.removeItem('gemGachaGame');
                points = 0;
                prisms = 0;
                inventory = {};
                equippedGems = [];
                volumes = { multi: false, chorus: false, lux: false };
                maxSlots = 1;
                chorus = 1;
                multiple = 1;
                window.totalLux = 0;
                updateDisplay();
                updateEquippedGemDisplay();
                
                // ë³¼ë¥¨ ìƒì  ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™”
                resetVolumeShopButtons();
                
                showMessage('ê²Œì„ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'text-yellow-300');
            }
        }

        // ê²Œì„ ìƒíƒœê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ ìë™ ì €ì¥
        function autoSave() {
    if (!window.allowSave) {
        console.warn("ì €ì¥ ì°¨ë‹¨ë¨: ì½”ë“œ ë³€ì¡° ê°ì§€ë¨");
        return;
    }
    // í‰ì†Œì²˜ëŸ¼ ì €ì¥
    localStorage.setItem("saveData", JSON.stringify(gameData));
}

        // ì´ˆê¸° í™”ë©´ ì—…ë°ì´íŠ¸ ë° ë°ì´í„° ë¡œë“œ
        loadGameData();
        updateDisplay();
        updateEquippedGemDisplay();
        
        // ì´ˆê¸° ìŠ¤íƒ¯ ê³„ì‚° (ë¡œë“œëœ ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš°)
        if (equippedGems.length === 0) {
            window.totalLux = 0;
        }
                // íŒ¨ì¹˜ë…¸íŠ¸ ë‚´ìš© (ì—¬ê¸°ì„œ ìˆ˜ì •í•˜ë©´ ë¨!)
const patchNoteText = `
ğŸ“… 0.0.5 ì•ŒíŒŒ ì—…ë°ì´íŠ¸(2025.9.7)
- ë§¤í¬ë¡œ ë°©ì§€ ê¸°ëŠ¥ ì¶”ê°€
- ì´ë²¤íŠ¸ ë³´ì„ 3ì¢…, ì—í”½ ë³´ì„ 1ì¢… ì¶”ê°€
- <ì •ì œ> ì´ë²¤íŠ¸ ê´‘ì„ ì¶œí˜„!(~9.10)
- ì—…ë°ì´íŠ¸ ë¦¬ë”¤ ì½”ë“œ : ReF5in3(ì‹ ê·œ ì—í”½ ë³´ì„)
`;

// ë²„íŠ¼ ì´ë²¤íŠ¸
document.getElementById("patchNoteBtn").addEventListener("click", () => {
    document.getElementById("patchNoteContent").textContent = patchNoteText;
    document.getElementById("patchNoteModal").classList.remove("hidden");
});

// ë‹«ê¸° ë²„íŠ¼
document.getElementById("closePatchNote").addEventListener("click", () => {
    document.getElementById("patchNoteModal").classList.add("hidden");
});

// ëª¨ë‹¬ ë°”ê¹¥ í´ë¦­ ì‹œ ë‹«ê¸°
document.getElementById("patchNoteModal").addEventListener("click", (e) => {
    if (e.target.id === "patchNoteModal") {
        document.getElementById("patchNoteModal").classList.add("hidden");
    }
});
        const originalSave = saveGameData.toString();
const originalUpdate = updateDisplay.toString();

setInterval(() => {
    if (saveGameData.toString() !== originalSave || updateDisplay.toString() !== originalUpdate) {
        console.warn("ì½”ë“œ ë³€ì¡° ê°ì§€ë¨!");
        window.allowSave = false;
    }
}, 2000);
